
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste du Personnel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
</head>
<body>
   <%- include('partials/sidebar', { currentPage: 'personnel-list' }) %>
    
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-10 offset-md-2 px-4 py-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Liste du Personnel</h2>
                    <a href="/personnel/add" class="btn btn-primary">
                        <i class="bi bi-person-plus me-2"></i> Ajouter Personnel
                    </a>
                </div>

                <!-- Filters -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">Type de Personnel</label>
                                <select class="form-select" id="filterType">
                                    <option value="">Tous</option>
                                    <option value="Biologiste">Biologiste</option>
                                    <option value="Technicien">Technicien</option>
                                    <option value="Cadre">Cadre</option>
                                    <option value="Secrétaire">Secrétaire</option>
                                    <option value="Préleveur">Préleveur</option>
                                    <option value="Agent Logistique">Agent Logistique</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Département</label>
                                <select class="form-select" id="filterDept">
                                    <option value="">Tous</option>
                                    <option value="Biochimie">Biochimie</option>
                                    <option value="Hématologie">Hématologie</option>
                                    <option value="Microbiologie">Microbiologie</option>
                                    <option value="Biologie délocalisée">Biologie délocalisée</option>
                                    <option value="Immuno-Séro-Electro">Immuno-Séro-Electro</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Statut</label>
                                <select class="form-select" id="filterStatus">
                                    <option value="Actif">Actif</option>
                                    <option value="Inactif">Inactif</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">&nbsp;</label>
                                <button class="btn btn-secondary w-100" onclick="resetFilters()">
                                    <i class="bi bi-arrow-clockwise me-2"></i> Réinitialiser
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personnel Table -->
                <div class="card">
                    <div class="card-body">
                        <table id="personnelTable" class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Matricule</th>
                                    <th>Nom</th>
                                    <th>Prénom</th>
                                    <th>Type</th>
                                    <th>Email</th>
                                    <th>Téléphone</th>
                                    <th>Date Embauche</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script>
        $(document).ready(function() {
            const table = $('#personnelTable').DataTable({
                ajax: '/personnel/api/list',
                columns: [
                    { data: 'matricule' },
                    { data: 'nom' },
                    { data: 'prenom' },
                    { data: 'type_personnel' },
                    { data: 'email' },
                    { data: 'telephone' },
                    { data: 'date_embauche' },
                    {
                        data: null,
                        render: function(data, type, row) {
                            return `
                                <button class="btn btn-sm btn-info" onclick="viewDetails(${row.id})">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <a href="/personnel/edit/${row.id}" class="btn btn-sm btn-warning">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <button class="btn btn-sm btn-danger" onclick="deletePersonnel(${row.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            `;
                        }
                    }
                ],
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json'
                }
            });

            $('#filterType, #filterDept, #filterStatus').on('change', function() {
                table.ajax.reload();
            });
        });

        function resetFilters() {
            $('#filterType, #filterDept, #filterStatus').val('');
            $('#personnelTable').DataTable().ajax.reload();
        }

        function deletePersonnel(id) {
            if(confirm('Êtes-vous sûr de vouloir supprimer ce personnel?')) {
                fetch(`/personnel/delete/${id}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        alert('Personnel supprimé avec succès');
                        $('#personnelTable').DataTable().ajax.reload();
                    });
            }
        }
    </script>
</body>
</html>