<!-- ==================== views/rh/recrutements/form.ejs ==================== -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= recrutement ? 'Modifier' : 'Nouveau' %> Recrutement</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    :root {
      --sidebar-width: 250px;
    }
    .main-content {
      margin-left: var(--sidebar-width);
      padding: 30px;
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <%- include('../../partials/sidebar', { currentPage: 'recrutements' }) %>
  
  <div class="main-content">
    <div class="container-fluid px-4 py-4">
      <!-- En-tête -->
      <div class="mb-4">
        <h2><i class="bi bi-person-plus-fill text-success"></i> <%= recrutement ? 'Modifier' : 'Nouveau' %> Recrutement</h2>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/dashboard">Accueil</a></li>
            <li class="breadcrumb-item"><a href="/rh/dashboard">RH</a></li>
            <li class="breadcrumb-item"><a href="/rh/recrutements">Recrutements</a></li>
            <li class="breadcrumb-item active"><%= recrutement ? 'Modifier' : 'Nouveau' %></li>
          </ol>
        </nav>
      </div>

      <!-- Formulaire -->
      <form method="POST" action="/rh/recrutements/<%= recrutement ? recrutement.id + '/edit' : 'nouveau' %>">
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="bi bi-info-circle"></i> Informations Générales</h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <!-- Référence -->
              <div class="col-md-4">
                <label class="form-label">Référence <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="reference" 
                       value="<%= recrutement ? recrutement.reference : 'REC-' + Date.now() %>" 
                       <%= recrutement ? 'readonly' : '' %> required>
              </div>

              <!-- Poste -->
              <div class="col-md-8">
                <label class="form-label">Poste <span class="text-danger">*</span></label>
                <select class="form-select" name="poste_id" required>
                  <option value="">Sélectionner un poste...</option>
                  <% postes.forEach(poste => { %>
                  <option value="<%= poste.id %>" 
                          <%= recrutement && recrutement.poste_id === poste.id ? 'selected' : '' %>>
                    <%= poste.titre %> - <%= poste.departement_nom %>
                  </option>
                  <% }) %>
                </select>
              </div>

              <!-- Type de recrutement -->
              <div class="col-md-4">
                <label class="form-label">Type de Recrutement <span class="text-danger">*</span></label>
                <select class="form-select" name="type_recrutement" required>
                  <option value="">Sélectionner...</option>
                  <option value="CDI" <%= recrutement && recrutement.type_recrutement === 'CDI' ? 'selected' : '' %>>CDI</option>
                  <option value="CDD" <%= recrutement && recrutement.type_recrutement === 'CDD' ? 'selected' : '' %>>CDD</option>
                  <option value="Stage" <%= recrutement && recrutement.type_recrutement === 'Stage' ? 'selected' : '' %>>Stage</option>
                  <option value="Alternance" <%= recrutement && recrutement.type_recrutement === 'Alternance' ? 'selected' : '' %>>Alternance</option>
                  <option value="Intérim" <%= recrutement && recrutement.type_recrutement === 'Intérim' ? 'selected' : '' %>>Intérim</option>
                </select>
              </div>

              <!-- Nombre de postes -->
              <div class="col-md-4">
                <label class="form-label">Nombre de Postes <span class="text-danger">*</span></label>
                <input type="number" class="form-control" name="nombre_postes" min="1"
                       value="<%= recrutement ? recrutement.nombre_postes : 1 %>" required>
              </div>

              <!-- Statut -->
              <div class="col-md-4">
                <label class="form-label">Statut</label>
                <select class="form-select" name="statut">
                  <option value="Brouillon" <%= !recrutement || recrutement.statut === 'Brouillon' ? 'selected' : '' %>>Brouillon</option>
                  <option value="Ouvert" <%= recrutement && recrutement.statut === 'Ouvert' ? 'selected' : '' %>>Ouvert</option>
                  <option value="En cours" <%= recrutement && recrutement.statut === 'En cours' ? 'selected' : '' %>>En cours</option>
                  <option value="Cloturé" <%= recrutement && recrutement.statut === 'Cloturé' ? 'selected' : '' %>>Cloturé</option>
                </select>
              </div>

              <!-- Date ouverture -->
              <div class="col-md-6">
                <label class="form-label">Date d'Ouverture <span class="text-danger">*</span></label>
                <input type="date" class="form-control" name="date_ouverture"
                       value="<%= recrutement && recrutement.date_ouverture ? recrutement.date_ouverture.toISOString().split('T')[0] : new Date().toISOString().split('T')[0] %>" required>
              </div>

              <!-- Date clôture -->
              <div class="col-md-6">
                <label class="form-label">Date de Clôture</label>
                <input type="date" class="form-control" name="date_cloture"
                       value="<%= recrutement && recrutement.date_cloture ? recrutement.date_cloture.toISOString().split('T')[0] : '' %>">
              </div>

              <!-- Description -->
              <div class="col-md-12">
                <label class="form-label">Description du Poste</label>
                <textarea class="form-control" name="description" rows="4"><%= recrutement ? recrutement.description || '' : '' %></textarea>
              </div>

              <!-- Exigences -->
              <div class="col-md-12">
                <label class="form-label">Exigences & Qualifications</label>
                <textarea class="form-control" name="exigences" rows="4"><%= recrutement ? recrutement.exigences || '' : '' %></textarea>
                <small class="text-muted">Diplômes, expériences, compétences requises...</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-success">
            <i class="bi bi-save"></i> Enregistrer
          </button>
          <a href="/rh/recrutements" class="btn btn-secondary">
            <i class="bi bi-x-circle"></i> Annuler
          </a>
        </div>
      </form>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>